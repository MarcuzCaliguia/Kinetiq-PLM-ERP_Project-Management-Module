<!-- templates/project_tasks/new_internal_task.html -->
{% extends 'project_tasks/base.html' %}

{% block extra_css %}
<style>
    .form-container {
        max-width: 800px;
        margin: 0 auto;
    }
    .required-label::after {
        content: "*";
        color: #dc3545;
        margin-left: 4px;
    }
    .form-floating > label {
        opacity: 0.65;
    }
    .deadline-warning {
        display: none;
        color: #dc3545;
        font-size: 0.875rem;
        margin-top: 0.25rem;
    }
    .deadline-warning.show {
        display: block;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4 mb-5">
    <div class="form-container">
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{% url 'task_list' %}">Tasks</a></li>
                <li class="breadcrumb-item active">New Internal Task</li>
            </ol>
        </nav>
        
        <h1 class="mb-4">New Internal Task</h1>
        
        <form method="post" id="taskForm" class="needs-validation" novalidate>
            {% csrf_token %}
            
            <div class="card mb-4">
                <div class="card-body">
                    <h5 class="card-title mb-4">Task Information</h5>
                    
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="form-floating mb-3">
                                <select class="form-select" id="status" name="status" required>
                                    <option value="pending">Pending</option>
                                    <option value="in_progress">In Progress</option>
                                    <option value="completed">Completed</option>
                                    <option value="canceled">Canceled</option>
                                </select>
                                <label for="projectId" class="required-label">Project ID</label>
                                <div class="invalid-feedback">Please select a project</div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="form-floating mb-3">
                                <select class="form-select" id="laborId" name="laborId" required>
                                    <option value="">Select Labor</option>
                                    {% for lab in labor %}
                                        <option value="{{ lab.intrnl_project_labor_id }}">{{ lab.intrnl_project_labor_id }}</option>
                                    {% endfor %}
                                </select>
                                <label for="laborId" class="required-label">Labor ID</label>
                                <div class="invalid-feedback">Please select a labor ID</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="form-floating mb-3">
                                <input type="date" class="form-control" id="deadline" name="deadline" required>
                                <label for="deadline" class="required-label">Deadline</label>
                                <div class="invalid-feedback">Please provide a deadline</div>
                                <div class="deadline-warning" id="deadlineWarning">
                                    <i class="bi bi-exclamation-triangle-fill"></i> This deadline is in the past
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="form-floating mb-3">
                                <select class="form-select" id="status" name="status" required>
                                    <option value="pending">Pending</option>
                                    <option value="in_progress">In Progress</option>
                                    <option value="completed">Completed</option>
                                    <option value="cancelled">Cancelled</option>
                                </select>
                                <label for="status" class="required-label">Status</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-floating mb-3">
                        <textarea class="form-control" id="description" name="description" style="height: 120px"></textarea>
                        <label for="description">Description</label>
                    </div>
                </div>
            </div>
            
            <div class="d-flex justify-content-between">
                <a href="{% url 'task_list' %}" class="btn btn-outline-secondary">Cancel</a>
                <button type="submit" class="btn btn-primary">
                    <i class="bi bi-save me-1"></i> Save Task
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Form validation
        const form = document.getElementById('taskForm');
        const deadline = document.getElementById('deadline');
        const deadlineWarning = document.getElementById('deadlineWarning');
        
        // Set default deadline to today
        const today = new Date();
        const formattedDate = today.toISOString().split('T')[0];
        deadline.value = formattedDate;
        
        // Check if deadline is in the past
        deadline.addEventListener('change', function() {
            const selectedDate = new Date(this.value);
            const currentDate = new Date();
            currentDate.setHours(0, 0, 0, 0); // Reset time to start of day
            
            if (selectedDate < currentDate) {
                deadlineWarning.classList.add('show');
            } else {
                deadlineWarning.classList.remove('show');
            }
        });
        
        // Form submission validation
        form.addEventListener('submit', function(event) {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            form.classList.add('was-validated');
        });
    });
</script>
{% endblock %}